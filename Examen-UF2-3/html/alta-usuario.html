<!DOCTYPE html>
	<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="X-UA-Compatible" content="ie=edge">
		<meta name="description" content="Consulta toda la información para la mujer en el suplemento de LOOK: Moda, tendencias, belleza, pareja, Lifestyle, vídeos  noticias de famosas. ¡Entra!">
		<meta name="keywords" content="Look, revista online, revista look, belleza, trucos de belleza, consejos de belleza, tratamientos esteticos, maquillaje, peluqueria, perfumes, trucos de belleza de famosas,">
		<meta http-equip="Expires" content="no-cache">
		<link rel="stylesheet" href="../lib/css/bootstrap.min.css">
		<link rel="shortcut icon" href="../img/favicon.ico" type="image/x-icon">
		<link rel="icon" href="../img/favicon.ico" type="image/x-icon">
		<script src="../lib/js/jquery.min.js"></script>
		<script src="../lib/js/bootstrap.min.js"></script>
		<script src="../js/funciones.js"></script>
		<title>LOOK</title>
		<link rel="stylesheet" href="../css/style.css"> 
		<script src="https://code.jquery.com/jquery-3.2.1.js"></script><!--Enlace a jquery en lugar de descargar-->
		<!--script src="../js/jquery.form.js" type="text/javascript"></script>
		<script src="../js/jquery.validate.js" type="text/javascript"></script-->
			<!--script src="https://code.jquery.com/jquery-1.11.1.min.js"></script-->
			<script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/jquery.validate.min.js"></script>
			<script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/additional-methods.min.js"></script>

	</head>
	<body>
		<noscript>Disculpe, su navegador no soporta JavaScript!</noscript>
		<div class="recuadro">   
		<div class="revista">
		</div>
        <div id="registro">
			<div class="alert alert-success" id="alert" style="display: none;text-align: center;"> &nbsp;</div> 
			<form id="formulario-alta" method="post">
                <div id="registroCab"> 
					<h3>REGISTRO DE ALTA</h3>	
				</div> 
                <div id="registroCuerpoH"> 
					<hr>
					<input type="hidden" name="nivel" id="nivel" value="basic">
					<label for="nombre">Nombre usuario: </label> <input type="text" name="usuario" id="nombre"  maxlength="30">
					<br><br>
					<label for="nacimiento">Fecha nacimiento: </label> <input type="date" name="nacimiento" id="nacimiento" >
					<br><br>
					<label for="correo">Correo: </label><input type="email" name="correo" id="correo" maxlength="30">
					<br><br>
					<label for="contrasena1">Contraseña: </label><input type="password" name="contrasena" id="contrasena1" minlength="4" maxlength="8">	
					<br><br>
					<label for="contrasena2">Repite contraseña: </label><input type="password" name="contrasena2" id="contrasena2" minlength="4" maxlength="8" >	
					<br><br>
					<hr>                    
					<span>Recordar usuario  </span><input type="checkbox" name="recordar">
					<br><br>
					<input type="submit" class="submit" name="enviar" value="Alta usuario">
					<br><br><br>
					<span class="nota">Todos los campos son obligatorios para el alta de un nuevo usuario</span>
                </div>				
			</form>
	
		</div>
		</div>
	
	<!-------------------------------FIN ----------------------------------->
	<script>
		
		$(document).ready(function(){
			jQuery.validator.setDefaults({
				debug: true,
				success: "valid"
				
				});
				
					
			jQuery.validator.addMethod(
				"regex",
				function(value, element, regexp) {
					var re = new RegExp(regexp);
					return this.optional(element) || re.test(value);
				},
					"No se admiten carácteres especiales",	
			);
			
			jQuery.validator.addMethod(
				"edad", 
				function(value, element) {              
					var from = value.split("-"); //YYY MM DD

					var dia = from[2];
					var mes = from[1];
					var ano = from[0];

					// cogemos los valores actuales
					var fecha_hoy = new Date();
					var ahora_ano = fecha_hoy.getYear();
					var ahora_mes = fecha_hoy.getMonth()+1;
					var ahora_dia = fecha_hoy.getDate();
			
					// realizamos el calculo
					var edad = (ahora_ano + 1900) - ano;
					if ( ahora_mes < mes ) {
						edad--;
					}
					if ((mes == ahora_mes) && (ahora_dia < dia)) {
						edad--;
					}
					if (edad > 1900) {
						edad -= 1900;
					}

					if (edad >=18) {
						return true;
					}else {
						return false;
					}
				},	
			);

			$("#formulario-alta").validate({
				event: "blur",
				rules: {	
					'usuario': {
							required: true,
							maxlength: 30,
							regex: "^[0-9a-zA-ZáéíóúàèìòùÀÈÌÒÙÁÉÍÓÚñÑçÇüÜ_\s]{1,30}$"
					},
					'nacimiento': {
							required:true,
							date:true,
							edad: true
					},
					'correo': {
						required: true,
						email: true
					},
					'contrasena': {
						required: true,
						minlength: 4,
						maxlength: 8
					},
					'contrasena2': {
						required: true,
						equalTo: "#contrasena1"
					},
				},
				messages: {
							'usuario': {
								required: "Por favor indica tu nombre",
								maxlength: "Ha excedido la longitud máxima de 30"
							},
							'correo': {
								required: "Por favor, indica una dirección de e-mail válida",
								email: "Formato correo erroneo"
							},
							'nacimiento': {
								required: "Por favor, indica tu fecha de nacimiento!",
								date: "Por favor, fecha no valida",
								edad: "Por favor, debe ser mayor de edad"
							},
							'contrasena': {
								required: "Por favor, introduce la contraseña que desees",
								minlength: "La longitud mínima es 4",
								maxlength: "La longitud máxima es 8"
							},
							'contrasena2': {
								required: "Por favor, retipe la contraseña"},
								equalTo: "Las contraseñas no coinciden"
							},
				debug: true,errorElement: "label",				
				submitHandler: function(form){
						if ( $('#alert').hasClass('alert-danger'))
						{
							$('#alert').removeClass('alert-danger');
							$('#alert').addClass('alert-success');
						}
						$("#alert").show();
						$("#alert").html("<img src='../img/ajax-loader.gif' style='vertical-align:middle;margin:0 10px 0 0' /><strong>Enviando mensaje...</strong>");
						setTimeout(function() {
							$('#alert').fadeOut('slow');
						}, 3000);
					$.ajax({
						type: "POST",
						url:"../php/alta-usuario.php",
						//dataType: 'JSON', //'html', //Para enviar y recibir con una estruccura simple
						data: "usuario="+escape($('#nombre').val())+"&nacimiento="+escape($('#nacimiento').val())+"&correo="+escape($('#correo').val())+"&contrasena="+escape($('#contrasena1').val())+"&contrasena2="+escape($('#contrasena2').val())+"&nivel="+escape($('#nivel').val()),
						success: function(jsondata){
							console.log("hola");
							console.log(jsondata);
							console.log(jsondata.msg);
							console.log(jsondata.estado);	
							console.log(jsondata.nombre);						
							//$("#alert").html(jsondata.msg);

							if (jsondata.estado) {
								console.log("hola2");
								$("#alert").html(jsondata.msg);
								setTimeout(function() {
									$('#alert').fadeOut('slow');
								}, 9000);		
            					document.getElementById("nombre").value="";
								document.getElementById("nacimiento").value="";
								document.getElementById("correo").value="";
								document.getElementById("contrasena1").value="";
								document.getElementById("contrasena2").value="";
								location.replace("../php/look.php");
								//location.href ="../php/look.php";
							}else{
								if ( $('#alert').hasClass('alert-success'))
								{
									$('#alert').removeClass('alert-success');
									$('#alert').addClass('alert-danger');
								}
								$("#alert").html(jsondata.msg);	
								setTimeout(function() {
									$('#alert').fadeOut('slow');
								}, 9000);		
							}
						},
						// Ya lo hace en el inicio el reloj
						//beforeSend: function(){
							//this will be triggered before sending the ajax request
							//console.log('Enviando datos desde AJAX ...');
						//},
						error: function(xhr, status, error){
         					var errorMessage = xhr.status + ': ' + xhr.statusText;
							//this will be triggered when the request fails
							console.log('Codigo estado del envío: ' + errorMessage);//200 es correcto OK
						}					
					});
				}
			});
		});
	</script>
	 
	</body>
</html>


